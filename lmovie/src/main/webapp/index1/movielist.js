;/*!movie:widget/movielist/movielist.js*/
define("movie:widget/movielist/movielist.js",function(t,e,i){var a={focus:"/movie/focus",movielist:"/movie/getmovielist"},o=t("common:widget/ui/pager/pager"),n=t("common:widget/ui/backup/backup"),s=t("common:static/util/http"),r=t("common:static/util/location"),c=t("common:static/util/account"),p={init:function(){var t=this;t.pageNum=0,t.pageSize=10,t.initStatus=!1,t.widgetMovieMovielist=$("#widgetMovieMovielist"),t.location=r.getCity(),t.pageData=Page.getData(),t.type=t.pageData.type||"hot",t.pipeRequest(),t.user=c.getUser(),t.tabList=$("#widgetMovieTopnav")},pipeRequest:function(){function t(){e.initStatus||(e.render(),e.bind(),e.initStatus=!0),e.flag=!1}var e=this,i=e.type,o=e.pageNum,n=e.pageSize,s=e.location.cityId,r={type:i,cityId:s,pageNum:o,pageSize:n,needMovieNews:!1},c={pagelets:"pageletMovielist",url:a.movielist,extend:!1,param:"",cb:t};"hot"==i&&(r.isHomePage=!1,r.needSliceAdSpace=!1),c.param=$.param(r),BigPipe.load(c)},render:function(){var t=this;t.initPager(),new n},initPager:function(){{var t=this,e=(t.data,$("#pagerInfo")),i=e.attr("data-pageCount");e.attr("data-pageSize")}o.init({dom:"#pagerContainer",pageCount:i,preventInitEvent:!0,onclick:function(e){if(t.flag)return!1;var i="webMovieListPg.pagerBk.pagerBtn";window.addStat({da_src:i,da_act:"click"}),t.flag=!0,t.pageNum=e.page,t.pipeRequest(),$("html,body").animate({scrollTop:0},500)}})},bind:function(){var t=this;t.widgetMovieMovielist.on("click",".mark",function(){t.collect($(this))})},switchType:function(t){var e=this;e.pageNum=0,t.addClass("active").siblings().removeClass("active"),e.type=t.attr("data-type"),e.pipeRequest()},collect:function(t){var e=this,i=t.attr("data-id"),o=t.attr("data-token"),n=t.hasClass("marked")?2:1,r=a.focus,c=e.user;if(!c.status)return void alert("您还未登录~");var p=2==n?"webMovieListPg.movieBk.cancelCollectBtn":"webMovieListPg.movieBk.collectBtn";window.addStat({da_src:p,da_act:"click"}),s.ajax({url:r,type:"get",data:{focusOperateType:n,movieIds:[i],token:o},success:function(e){e&&0===e.errorNo?2===n?t.html("<em></em>想看").removeClass("marked"):t.html("<em></em>已标记想看").addClass("marked"):alert(e.errorMsg||"系统出错，请稍后重试")},error:function(t){alert(t.errorMsg||"系统出错，请稍后重试")}})}};i.exports=p});