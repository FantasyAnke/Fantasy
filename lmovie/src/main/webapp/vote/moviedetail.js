;/*!movie:widget/moviedetail/intro/intro.js*/
define("movie:widget/moviedetail/intro/intro.js",function(o,t,i){var e=o("common:static/util/http"),n=o("common:widget/ui/dialog/dialog"),a=o("common:static/util/account"),c={focus:"/movie/focus"},r={init:function(){var o=this;o.ele=$("#detailIntro"),o.eleCopy=$("#infoCopy"),o.user=a.getUser(),o.bind()},bind:function(){{var o=this;$("#contentBtn"),$("#intro")}o.ele.on("click","#moreBtn",function(){o.showMore()}),$(document).on("click","#chooseCinema",function(){o.dialog&&o.dialog.hide()}),o.ele.on("click",".collect",function(){var t=$(this);o.setFocus(t)})},showMore:function(){var o=this,t=o.eleCopy;o.dialog=n.init({html:t,height:"auto",width:475}),o.dialog.show()},setFocus:function(o){var t=this,i=c.focus,n=t.user,a=o.attr("data-id"),r=o.attr("data-token"),s={movieIds:[a],token:r},d=o.hasClass("marked")?2:1;return window.addStat({da_src:"webMovieDetailPg.introBk.markBtn",da_act:"click"}),n.status?void(a&&!t.focusing&&(t.focusing=!0,s.focusOperateType=d,e.ajax({url:i,data:s,success:function(i){return t.focusing=!1,i&&i.data&&0===i.errorNo?void(i&&0===i.errorNo&&(2===d?o.html("<em>想看</em>").removeClass("marked"):o.html("<em>已标记想看</em>").addClass("marked"))):(alert("标记失败"),void(t.focusing=!1))},error:function(){alert("标记失败"),t.focusing=!1}}))):void alert("您还未登录~")}};i.exports=r});
;/*!movie:widget/moviedetail/moviedetail.js*/
define("movie:widget/moviedetail/moviedetail.js",function(e,a,t){var i=e("common:widget/ui/backup/backup"),s=e("common:static/util/http"),l=e("common:static/util/account"),r=e("common:static/util/location"),d={focus:"/movie/focus"},n={init:function(){var e=this;e.firstMark=!0,e.pageSize=6,e.pageOpt=Page.getData(),e.pageNum=0,e.user=l.getUser(),e.locOpt=r.getSelectedCity(),e.getEle(),e.render(),e.bind(),e.pipeRequest(),e.getMore()},getEle:function(){var e=this;e.ele=$("#widgetMovieDetail")},render:function(){var e=this;e.backup=new i},bind:function(){var e=this,a=e.ele,t="filter-active";a.on("click",".list-first [data-target]",function(){var a=$(this),i=a.attr("data-target"),s=a.siblings(),l=s.length,r=$("[data-src="+i+"]");if(!a.hasClass(t)){for(var d=0;l>d;d++){var n=s.eq(d),o=n.attr("data-target"),c=$("[data-src="+o+"]");a.hasClass("all")&&c.find("."+t).removeClass(t),c.removeClass(t)}a.addClass(t).siblings().removeClass(t),r.addClass(t),a.hasClass("all")&&(e.curType=null,e.getFilters())}}),a.on("click",'[data-type="cinema-filter"]',function(){{var a=$(this);$("#brandList"),$(this)}if(!a.hasClass(t)){a.addClass(t).siblings().removeClass(t);var i=a.parent();i&&i.length>0&&i.attr("data-src")&&(e.curType=i.attr("data-src")),e.getFilters()}}),a.on("click","#moreCinema",function(){var a=$(this),t=e.obj||{},i=a.attr("data-totalnum");t.pageNum=e.pageNum=++e.pageNum;var s=(e.pageNum+1)*e.pageSize;e.pipeRequest(t,"list"),s>=i&&a.html("没有更多结果了")})},getFilters:function(){var e,a,t,i,s,l,r=this,d=r.ele.find(".area"),n=r.ele.find(".date"),o="filter-active",c={},m=d.find(".list-first li"),g=d.find(".list-first ."+o),p=m.length;if(g.hasClass("all"))c={};else for(var u=0;p>u;u++)e=m.eq(u),a=e.attr("data-target"),t=$("[data-src="+a+"]"),t&&t.length>0&&(i=t.find("."+o),i&&i.length>0&&(s=i.attr("data-key"),l=i.attr("data-id"),s&&(c[s]=l)));var f=n.find("."+o),v=f.attr("data-key"),h=f.attr("data-id");v&&(c[v]=h),c.pageNum=0,r.obj=c,r.pipeRequest(c)},pipeRequest:function(e,a){var t=this,e=e||{},i=t.pageOpt||{},s=$.extend({cityId:i.cityId||t.locOpt.cityId||"131",pageSize:t.pageSize,movieId:i.movieId,pageNum:0},e);if(!t.processing){t.processing=!0;var l,r={pagelets:[],url:"/movie/cinema",param:$.param(s),cb:function(){var e=t.loading;e&&e.length>0&&e.removeClass("hide")&&e.addClass("hide")}};"list"===a?(l=["pageletCinemalist@pageletCinema"],r.extend=!0,r.cb=function(){t.processing=!1}):(l=["pageletCinema"],r.extend=!1,r.cb=function(){t.dealActive(),t.processing=!1,t.scrolltoRealTime()}),r.pagelets.push(l),BigPipe.load(r)}},dealActive:function(){var e=this,a=e.obj||{},t=e.curType,i=$("[data-target="+t+"]"),s=a.areaId,l=a.metroLineId,r=a.date,d=$("#aoiList"),n=$("#subwayList"),o=$("#dateList"),c=o.find("li"),m="filter-active";if(s&&d.find("[data-id="+s+"]").addClass(m),l&&n.find("[data-id="+l+"]").addClass(m),r&&o.find("[data-id="+r+"]").addClass(m),!r&&c&&c.length>0&&c.eq(0).addClass(m),!t)return void $("#areaAll").addClass(m);var g=$("[data-src="+t+"]");g&&g.length>0&&g.hasClass("list-sec")&&(g.addClass(m),i&&i.length>0&&i.addClass(m)),!s&&!l&&$("#areaAll").addClass(m)},getMore:function(){var e,a=this,t=a.pageOpt,i={cityId:t.cityId||a.locOpt.cityId||"131",movieId:t.movieId,needLimit:!1};e={pagelets:["pageletMore"],url:"/movie/moviedetail",param:$.param(i),cb:function(){}}},focus:function(e){var a=this,t=a.pageOpt,i=t.movieId,l=d.focus,r=a.user,n=e.hasClass("collected")?0:1;return r.status?void s.ajax({url:l,type:"get",data:{focusOperateType:n,movieIds:[i]},success:function(e){e&&0===e.errorNo&&(2===n?ele.html("<em></em>想看").removeClass("marked"):ele.html("<em></em>已标记想看").addClass("marked"))},error:function(){alert("标记失败")}}):void alert("您还未登录~")},scrolltoRealTime:function(){var e=this,a=window.location.hash;"#realtimebox"===a&&e.firstMark&&(r.href="#realtimebox",e.firstMark=!1)}};t.exports=n});