;/*!buy:widget/seat/select/selectbase.js*/
define("buy:widget/seat/select/selectbase.js",function(e,t,n){var i={getTotalPrice:function(e,t){return e*t/100},getIntimeData:function(){var e=window.seatsIntime||{};return e}};n.exports=i});
;/*!buy:widget/seat/select/select.js*/
define("buy:widget/seat/select/select.js",function(require,exports,module){var base=require("buy:widget/seat/select/selectbase.js"),pager=require("common:widget/ui/pager/pager"),urls={lock:"/buy/lockSeat"},MAX_SEAT=5,SEAT_TMPL=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';if(eval(_template_varName),_template_fun_array.push(""),!results||results.length<=0)_template_fun_array.push('    <li class="text-center">没有可售座位了</li>');else{_template_fun_array.push("    ");var length=results.length;_template_fun_array.push("    ");for(var counter=0;length>counter;counter++){_template_fun_array.push("    ");var result=results[counter];_template_fun_array.push('        <li class="row-item clearfix">           ');var seatList=result.seatList||[];_template_fun_array.push("           ");var len=seatList.length;_template_fun_array.push("           ");for(var i=0;len>i;i++){_template_fun_array.push("               ");var seat=seatList[i];_template_fun_array.push("               ");var value=seat.value;_template_fun_array.push("               ");var loverSeat=seat.loverSeat;_template_fun_array.push("                              "),1==value?(_template_fun_array.push('                     <span class="seat                     '),loverSeat&&(_template_fun_array.push("                         "),1==loverSeat&&_template_fun_array.push("seat-love-left"),_template_fun_array.push("                         "),2==loverSeat&&_template_fun_array.push("seat-love-right "),_template_fun_array.push("                     ")),_template_fun_array.push('"                     data-seatNo="',"undefined"==typeof seat.seatNo?"":baidu.template._encodeHTML(seat.seatNo),'" data-rowNo="',"undefined"==typeof result.rowNo?"":baidu.template._encodeHTML(result.rowNo),'" data-colNo="',"undefined"==typeof seat.colNo?"":baidu.template._encodeHTML(seat.colNo),'"></span>                ')):(_template_fun_array.push("                                          "),0==value?_template_fun_array.push("                        <span></span>                     "):_template_fun_array.push('                                                  <span class="seat seat-sold" data-seatNo="',"undefined"==typeof seat.seatNo?"":baidu.template._encodeHTML(seat.seatNo),'" data-rowNo="',"undefined"==typeof result.rowNo?"":baidu.template._encodeHTML(result.rowNo),'" data-colNo="',"undefined"==typeof seat.colNo?"":baidu.template._encodeHTML(seat.colNo),'"></span>                     '),_template_fun_array.push("               ")),_template_fun_array.push("           ")}_template_fun_array.push("        </li>    ")}_template_fun_array.push("")}_template_fun_array.push(""),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],http=require("common:static/util/http"),account=require("common:static/util/account"),select={commonStatus:{schSet:!1,cacheRendered:!1,cacheDataGot:!1,intimeDataGot:!1,intimeRendered:!1},commonData:{},seatsIntime:{},init:function(e,t){var a=this,s=a.data=a.getData(e);a.getEle(),a.pageData=Page.getData()||{},a.seatWidth=42,a.seatHeight=44,a.selectedSeat=[],a.len=s.len||0,a.maxNum=s.maxNum||MAX_SEAT,a.price=s.price||0,a.pageData=Page.getData(),a.user=account.getUser(),a.renderType=t,a.render(),a.bind()},getData:function(e){var t;e="string"==typeof e?JSON.parse(e||"{}"):e||{};for(var a,s,r,l=e.result||[],n=l.length,o=0,i=0;n>i;i++)a=l[i],r=a.seatList||[],s=r.length,s>o&&(o=s);return t={rows:n,len:o,maxNum:l.maxChooseNum,price:l.unitPrice||0}},getEle:function(){var e=this;e.ele=$("#widgetBuySeat"),e.seatArea=$("#seatArea"),e.seatsArea=$("#seatsArea"),e.loading=$("#loading"),e.centerLine=$("#centerLine"),e.seatsScroll=$("#seatsScroll"),e.selectedInfo=$("#selectedInfo"),e.theaterName=$("#theaterName"),e.emptyMsg=$("#emptyMsg"),e.seatList=$("#seatList")},render:function(){var e=this,t=(e.data||{},e.data.len),a=e.data.rows,s=e.seatWidth*t,r=e.seatHeight*a+44,l=e.renderType;e.totalWidth=s,s>0?(e.seatsArea.css({width:"100%",height:r}),e.seatList.css({width:s,height:r}),e.centerLine.css({left:s/2-7,height:e.seatHeight*e.data.rows-5}),e.seatArea.removeClass("hide"),"cache"==l&&(e.commonStatus.cacheRendered=!0),"intime"==l&&(e.commonStatus.intimeRendered=!0)):(e.commonStatus.cacheDataGot&&"intime"==l||e.commonStatus.intimeDataGot&&"cache"==l)&&e.emptyMsg&&e.emptyMsg.removeClass("hide"),e.loading.addClass("hide"),e.commonData.theaterName&&e.theaterName.html(e.commonData.theaterName)&&(e.commonStatus.schSet=!0),e.scrollSeats()},scrollSeats:function(){var e=this,t=e.seatArea,a=e.seatsScroll,s=e.totalWidth,r=t.width();a.animate({top:0,left:-.5*(s-r)},500)},bind:function(){var e=this,t=e.seatsScroll;t.off("click","span").on("click","span",function(){var t=$(this);e.seatClick(t)}),e.ele.off("click","#confirmSubmit").on("click","#confirmSubmit",function(){$.proxy(e.onConfirmClick(),this)})},seatClick:function(e){var t=this,a=t.user;if(!a.status)return void alert("您尚未登录~");if(!e.hasClass("seat-sold")&&e.hasClass("seat")){if(window.addStat({da_src:"webBuySeatPg.seatBk.seatBtn",da_act:"click"}),e.hasClass("seat-selected"))return t.seatCancel(e),e.hasClass("seat-love-left")?s=e.next():e.hasClass("seat-love-right")&&(s=e.prev()),void(s&&s.length>0&&t.seatCancel(s));var s;t.seatSelected(e),e.hasClass("seat-love-left")?s=e.next():e.hasClass("seat-love-right")&&(s=e.prev()),s&&s.length>0&&t.seatSelected(s)}},seatCancel:function(e){var t,a=this,s=a.selectedInfo,r=a.selectedSeat||[],l=r.length,n=e.attr("data-seatNo"),o=e.attr("data-colNo"),i=e.attr("data-rowNo");1===l&&s.find(".empty").removeClass("hide"),e.removeClass("seat-selected");for(var u=0;l>u;u++)if(t=r[u],t.seatNo===n){r.splice(u,1);break}var c=$("#"+i+"_"+o);c.remove(),a.updateInfo()},seatSelected:function(e){var t=this,a="",s=t.selectedSeat||[],r=s.length,l=t.selectedInfo,n=t.checkSeat();if(n){0===r&&l.find(".empty").addClass("hide"),e.addClass("seat-selected");var o=e.attr("data-seatNo"),i=e.attr("data-colNo"),u=e.attr("data-rowNo");s.push({seatNo:o,colNo:i,rowNo:u}),a='<li id="'+u+"_"+i+'"><p>'+u+"排"+i+"座</p></li>",l&&l.length>0&&l.append(a),t.updateInfo()}},checkSeat:function(){var e=this,t=e.selectedSeat||[],a=t.length,s=e.maxNum,r=!0;return a>s-1&&(alert("最多购买"+s+"张票~"),r=!1),r},updateInfo:function(){var e=this,t=e.selectedSeat||[],a=t.length||0,s=e.price||0,r=$("#confirmSubmit");0===s&&(s=$("#moviePrice").val()||0);var l=base.getTotalPrice(a,s);$("#totalNum").html(a+"张"),$("#totalPrice").find(".num").html(l+"元"),0>=a?r.addClass("disabled"):r.removeClass("disabled")},isSingleSeatLeft:function(){{var e=this,t=e.selectedSeat;t.length}return!1},checkupSeat:function(){var e,t,a,s,r=this,l=base.getIntimeData(),n=(l.length,r.selectedSeat),o=n.length;if(r.commonStatus.intimeRendered)return!1;if(!l||!l.result||!l.result.length>0)return!1;e=l.result;for(var i=0;o>i;i++)return t=n[i],a=t.colNo,s=t.rowNo,e[s]&&e[s].seatList&&e[s].seatList&&e[s].seatList[a]&&1==e[s].seatList[a].value?!1:!0},updateSeat:function(){var e=this,t=e.seatsIntime;if(t.result&&!(t.result.length<=0)){var a=SEAT_TMPL({results:t.result||[]});$("#seatList").html(a)}},onConfirmClick:function(){var e=this,t=$("#confirmSubmit");if(!t.hasClass("disabled")){if(e.isSingleSeatLeft())return void alert("选择的座位旁边不要留下单个空座");if(e.checkupSeat())return alert("座位不可售。将更新座位图"),void e.updateSeat();t.addClass("disabled"),window.addStat({da_src:"webBuySeatPg.scheduleBk.buyBtn",da_act:"click"}),e.lockSeat()}},lockSeat:function(){var e=this,t=urls.lock,a=$("#confirmSubmit"),s=e.pageData,r=e.selectedSeat||[],l=$("input.form-control-for-seatLock").val(),n=$("input.form-control-for-seatLock").attr("extradata"),o={cinemaId:s.cinemaId,movieId:s.movieId,seqNo:s.seqNo,seatInfo:r,token:l,cDate:n};http.ajax({url:t,method:"POST",data:$.param(o),success:function(e){e=e||{};var t=e.data||{},s=t.lockStatus,r=t.orderId;1===s?Page.start("/buy/orderconfirm",{orderId:r}):alert("锁座失败"),a.removeClass("disabled")},error:function(e){e&&9===+e.errorNo?(alert("当前登录账户需要先绑定手机号，才能继续购票"),window.open("https://passport.baidu.com/v2/accountsecurity?act=bindmobile"),a.removeClass("disabled")):alert("锁座失败")}})},renderSeat:function(e){var t=(e.data,SEAT_TMPL({results:seatsIntime.result||[]}));$("#seatList").html(t),select.commonStatus.intimeRendered=!0}};module.exports=select});
;/*!buy:widget/seat/seat.js*/
define("buy:widget/seat/seat.js",function(e,t,a){var i={seat:"/buy/getseat",schedule:"/buy/schedule"},n=e("buy:widget/seat/select/select.js"),s=e("common:static/util/http"),c=(e("common:static/util/bdTemplate"),{init:function(){var e=this;e.ele=$("#widgetBuySeat"),e.getData()},bind:function(){},getData:function(){var e=this;e.pageData=Page.getData()||{},e.getSeats(),e.getSeatsIntime(),e.getSchedule()},getSeats:function(){var e,t=this,a=t.pageData,s={cinemaId:a.cinemaId,movieId:a.movieId,seqNo:a.seqNo,cacheable:!0,isSmart:!1};e={pagelets:["pageletSelect"],url:i.seat,param:$.param(s),cb:function(){n.commonStatus.intimeDataGot&&(n.updateSeat(),n.init(t.seatsIntime,"intime"))}},BigPipe.load(e)},getSeatsIntime:function(){var e=this,t=i.seat,a=e.pageData,c={cinemaId:a.cinemaId,movieId:a.movieId,seqNo:a.seqNo,cacheable:!1,isSmart:!1};s.ajax({url:t,data:c,success:function(t){t=t||{};var a=n.seatsIntime=e.seatsIntime=t.data||{};n.commonStatus.cacheDataGot&&!n.commonStatus.cacheRendered&&n.updateSeat(),n.init(a,"intime"),n.commonStatus.intimeDataGot=!0},error:function(){e.seatsIntime={}}})},getSchedule:function(){var e=this,t={},a=e.pageData,s={cinemaId:a.cinemaId,movieId:a.movieId,date:a.date,seqNo:a.seqNo};t={pagelets:["pageletSchedule"],url:i.schedule,param:$.param(s),cb:function(){var e=$("#theaterNameInput").val();n.commonData.theaterName=e,n.commonStatus.schSet||$("#theaterName").html(e)}},BigPipe.load(t)}});a.exports=c});