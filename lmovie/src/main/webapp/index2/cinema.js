;/*!cinema:widget/cinema/cinema.js*/
define("cinema:widget/cinema/cinema.js",function(a,e,t){var i=a("common:widget/ui/backup/backup"),s=a("common:static/util/location"),n={init:function(){var a=this;a.pageSize=6,a.location=s.getCity(),a.pageNum=0,a.getEle(),a.render(),a.bind(),a.pipeRequest()},getEle:function(){var a=this;a.ele=$("#widgetCinemaCinema")},render:function(){var a=this;a.backup=new i},bind:function(){var a=this,e=a.ele,t="filter-active";e.on("click",".list-first [data-target]",function(){var e=$(this),i=e.attr("data-target"),s=e.siblings(),n=s.length,d=$("[data-src="+i+"]");if(!e.hasClass(t)){for(var l=0;n>l;l++){var r=s.eq(l),c=r.attr("data-target"),o=$("[data-src="+c+"]");e.hasClass("all")&&o.find("."+t).removeClass(t),o.removeClass(t)}e.addClass(t).siblings().removeClass(t),d.addClass(t),e.hasClass("all")&&(a.curType=null,a.getFilters())}}),e.on("click",'[data-type="cinema-filter"]',function(){{var e=$(this);$("#brandList"),$(this)}if(!e.hasClass(t)){e.addClass(t).siblings().removeClass(t);var i=e.parent();i&&i.length>0&&i.attr("data-src")&&(a.curType=i.attr("data-src")),a.getFilters(),a.pageNum=0}}),e.on("click","#moreCinema",function(){var e=$(this),t=a.obj||{},i=e.attr("data-totalnum");t.pageNum=a.pageNum=++a.pageNum;var s=a.pageNum*a.pageSize;a.pipeRequest(t,"list"),s>=i&&e.html("没有更多结果了")}),e.on("click","#brandToggle",function(){var a=$(this),e=$("#brandList");a.hasClass("slideup")?(e.removeClass("slideup"),a.removeClass("slideup")):(e.addClass("slideup"),a.addClass("slideup"))})},createContainer:function(a){var e=this,t=$("#cinemaCinemalist"),i="",s="cinemaContainer"+a,n=t.find(".loading");i='<div id="'+s+'"></div>',t.find("ul").append(i),n.removeClass("hide"),e.container=s,n&&n.length>0&&n.removeClass("hide")&&(e.loading=n)},getFilters:function(){var a,e,t,i,s,n,d=this,l=d.ele.find(".area"),r=d.ele.find(".cinema"),c="filter-active",o={},g=l.find(".list-first li"),p=l.find(".list-first ."+c),u=g.length;if(p.hasClass("all"))o={};else for(var m=0;u>m;m++)a=g.eq(m),e=a.attr("data-target"),t=$("[data-src="+e+"]"),t&&t.length>0&&(i=t.find("."+c),i&&i.length>0&&(s=i.attr("data-key"),n=i.attr("data-id"),s&&(o[s]=n)));var f=r.find("."+c),C=f.attr("data-key"),v=f.attr("data-id");C&&(o[C]=v),o.pageNum=0,d.obj=o,d.pipeRequest(o)},pipeRequest:function(a,e){var t=this,a=a||{},i=(t.location||{},Page.getData()||{}),s=$.extend({cityId:i.cityId,pageSize:t.pageSize,pageNum:0,date:Date.now(),sortType:2},a);if(!t.processing){t.processing=!0;var n,d={pagelets:"",url:"/cinema",param:$.param(s),cb:function(){var a=t.loading;a&&a.length>0&&a.removeClass("hide")&&a.addClass("hide")}};"list"===e?(n="pageletCinemalist@pageletCinema",d.extend=!0,d.cb=function(){t.processing=!1;var a=$("#moreCinema"),e=a.attr("data-totalnum");a&&a.length>0&&e<=(s.pageNum+1)*t.pageSize&&a.addClass("hide")}):(n="pageletCinema",d.extend=!1,d.cb=function(){t.dealActive(),t.processing=!1}),d.pagelets=n,BigPipe.load(d)}},dealActive:function(){var a=this,e=a.obj||{},t=a.curType,i=$("[data-target="+t+"]"),s=e.areaId,n=e.metroLineId,d=e.brandId,l=$("#aoiList"),r=$("#subwayList"),c=$("#brandList"),o="filter-active";if(s&&l.find("[data-id="+s+"]").addClass(o),n&&r.find("[data-id="+n+"]").addClass(o),d&&c.find("[data-id="+d+"]").addClass(o),!d&&$("#brandAll").addClass(o),!t)return void $("#areaAll").addClass(o);var g=$("[data-src="+t+"]");g&&g.length>0&&g.hasClass("list-sec")&&(g.addClass(o),i&&i.length>0&&i.addClass(o)),!s&&!n&&$("#areaAll").addClass(o)}};t.exports=n});